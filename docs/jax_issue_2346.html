---

title: Title

keywords: fastai
sidebar: home_sidebar

summary: "summary"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: jax_issue_2346.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">jax</span>
<span class="kn">from</span> <span class="nn">jax.experimental</span> <span class="kn">import</span> <span class="n">optimizers</span>
<span class="kn">from</span> <span class="nn">fax.implicit</span> <span class="kn">import</span> <span class="n">twophase</span>


<span class="c1"># doesn&#39;t matter what we return!</span>
<span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="n">pars</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,)[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">get_fit</span><span class="p">(</span>
    <span class="n">default_rtol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span>
    <span class="n">default_atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span>
    <span class="n">default_max_iter</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e7</span><span class="p">),</span>
    <span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="p">):</span>

    <span class="n">adam_init</span><span class="p">,</span> <span class="n">adam_update</span><span class="p">,</span> <span class="n">adam_get_params</span>  <span class="o">=</span> <span class="n">optimizers</span><span class="o">.</span><span class="n">adam</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">global_bestfit_minimized</span><span class="p">(</span><span class="n">ignored_param</span><span class="p">):</span>
        
        <span class="k">def</span> <span class="nf">bestfit_via_grad_descent</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>  <span class="c1"># gradient descent</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">log_likelihood</span><span class="p">)(</span><span class="n">param</span><span class="p">)</span>
            <span class="n">param</span> <span class="o">=</span> <span class="n">adam_get_params</span><span class="p">(</span><span class="n">adam_update</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">adam_init</span><span class="p">(</span><span class="n">param</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">param</span>

        <span class="k">return</span> <span class="n">bestfit_via_grad_descent</span>

    <span class="n">global_solve</span> <span class="o">=</span> <span class="n">twophase</span><span class="o">.</span><span class="n">two_phase_solver</span><span class="p">(</span>
        <span class="n">param_func</span><span class="o">=</span><span class="n">global_bestfit_minimized</span><span class="p">,</span>
        <span class="n">default_rtol</span><span class="o">=</span><span class="n">default_rtol</span><span class="p">,</span>
        <span class="n">default_atol</span><span class="o">=</span><span class="n">default_atol</span><span class="p">,</span>
        <span class="n">default_max_iter</span><span class="o">=</span><span class="n">default_max_iter</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">global_fit</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">ignored_param</span><span class="p">):</span>
        <span class="n">solve</span> <span class="o">=</span> <span class="n">global_solve</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">ignored_param</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">solve</span><span class="o">.</span><span class="n">value</span>

    <span class="k">return</span> <span class="n">global_fit</span>

<span class="k">def</span> <span class="nf">do_fit</span><span class="p">(</span><span class="n">ignored_param</span><span class="p">):</span>
    <span class="n">fit</span> <span class="o">=</span> <span class="n">get_fit</span><span class="p">()</span>
    
    <span class="c1"># Commenting this line gives the error</span>
    <span class="c1">#fit = jax.jit(fit) </span>
    
    <span class="k">return</span> <span class="n">fit</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="n">ignored_param</span><span class="p">)</span>

<span class="n">ignored_param</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">do_fit</span><span class="p">)(</span><span class="n">ignored_param</span><span class="p">)</span> <span class="c1"># throws the error</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/home/phinate/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/lib/xla_bridge.py:122: UserWarning: No GPU/TPU found, falling back to CPU.
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">--------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AssertionError</span>                           Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-1-2ff1168f5a07&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     49</span> 
<span class="ansi-green-intense-fg ansi-bold">     50</span> ignored_param <span class="ansi-blue-fg">=</span> <span class="ansi-cyan-fg">1</span>
<span class="ansi-green-fg">---&gt; 51</span><span class="ansi-red-fg"> </span>jax<span class="ansi-blue-fg">.</span>jit<span class="ansi-blue-fg">(</span>do_fit<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">(</span>ignored_param<span class="ansi-blue-fg">)</span> <span class="ansi-red-fg"># throws the error</span>

<span class="ansi-green-fg">~/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/api.py</span> in <span class="ansi-cyan-fg">f_jitted</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    144</span>     flat_fun<span class="ansi-blue-fg">,</span> out_tree <span class="ansi-blue-fg">=</span> flatten_fun<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> in_tree<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    145</span>     out = xla.xla_call(flat_fun, *args_flat, device=device, backend=backend,
<span class="ansi-green-fg">--&gt; 146</span><span class="ansi-red-fg">                        name=flat_fun.__name__)
</span><span class="ansi-green-intense-fg ansi-bold">    147</span>     <span class="ansi-green-fg">return</span> tree_unflatten<span class="ansi-blue-fg">(</span>out_tree<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> out<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    148</span> 

<span class="ansi-green-fg">~/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/core.py</span> in <span class="ansi-cyan-fg">call_bind</span><span class="ansi-blue-fg">(primitive, f, *args, **params)</span>
<span class="ansi-green-intense-fg ansi-bold">    640</span>   <span class="ansi-green-fg">if</span> top_trace <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    641</span>     <span class="ansi-green-fg">with</span> new_sublevel<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 642</span><span class="ansi-red-fg">       </span>outs <span class="ansi-blue-fg">=</span> primitive<span class="ansi-blue-fg">.</span>impl<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>params<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    643</span>   <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    644</span>     tracers <span class="ansi-blue-fg">=</span> map<span class="ansi-blue-fg">(</span>top_trace<span class="ansi-blue-fg">.</span>full_raise<span class="ansi-blue-fg">,</span> args<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/interpreters/xla.py</span> in <span class="ansi-cyan-fg">_xla_call_impl</span><span class="ansi-blue-fg">(fun, device, backend, name, *args)</span>
<span class="ansi-green-intense-fg ansi-bold">    446</span> 
<span class="ansi-green-intense-fg ansi-bold">    447</span> <span class="ansi-green-fg">def</span> _xla_call_impl<span class="ansi-blue-fg">(</span>fun<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> device<span class="ansi-blue-fg">,</span> backend<span class="ansi-blue-fg">,</span> name<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 448</span><span class="ansi-red-fg">   </span>compiled_fun <span class="ansi-blue-fg">=</span> _xla_callable<span class="ansi-blue-fg">(</span>fun<span class="ansi-blue-fg">,</span> device<span class="ansi-blue-fg">,</span> backend<span class="ansi-blue-fg">,</span> name<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>map<span class="ansi-blue-fg">(</span>arg_spec<span class="ansi-blue-fg">,</span> args<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    449</span>   <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    450</span>     <span class="ansi-green-fg">return</span> compiled_fun<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/linear_util.py</span> in <span class="ansi-cyan-fg">memoized_fun</span><span class="ansi-blue-fg">(fun, *args)</span>
<span class="ansi-green-intense-fg ansi-bold">    218</span>       fun<span class="ansi-blue-fg">.</span>populate_stores<span class="ansi-blue-fg">(</span>stores<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    219</span>     <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 220</span><span class="ansi-red-fg">       </span>ans <span class="ansi-blue-fg">=</span> call<span class="ansi-blue-fg">(</span>fun<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    221</span>       cache<span class="ansi-blue-fg">[</span>key<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">(</span>ans<span class="ansi-blue-fg">,</span> fun<span class="ansi-blue-fg">.</span>stores<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    222</span>     <span class="ansi-green-fg">return</span> ans

<span class="ansi-green-fg">~/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/interpreters/xla.py</span> in <span class="ansi-cyan-fg">_xla_callable</span><span class="ansi-blue-fg">(fun, device, backend, name, *arg_specs)</span>
<span class="ansi-green-intense-fg ansi-bold">    463</span>   pvals <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>pe<span class="ansi-blue-fg">.</span>PartialVal<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">(</span>aval<span class="ansi-blue-fg">,</span> core<span class="ansi-blue-fg">.</span>unit<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> aval <span class="ansi-green-fg">in</span> abstract_args<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    464</span>   <span class="ansi-green-fg">with</span> core<span class="ansi-blue-fg">.</span>new_master<span class="ansi-blue-fg">(</span>pe<span class="ansi-blue-fg">.</span>StagingJaxprTrace<span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> master<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 465</span><span class="ansi-red-fg">     </span>jaxpr<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">(</span>pvals<span class="ansi-blue-fg">,</span> consts<span class="ansi-blue-fg">,</span> env<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">=</span> pe<span class="ansi-blue-fg">.</span>trace_to_subjaxpr<span class="ansi-blue-fg">(</span>fun<span class="ansi-blue-fg">,</span> master<span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>call_wrapped<span class="ansi-blue-fg">(</span>pvals<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    466</span>     <span class="ansi-green-fg">assert</span> <span class="ansi-green-fg">not</span> env  <span class="ansi-red-fg"># no subtraces here</span>
<span class="ansi-green-intense-fg ansi-bold">    467</span>     <span class="ansi-green-fg">del</span> master<span class="ansi-blue-fg">,</span> env

<span class="ansi-green-fg">~/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/linear_util.py</span> in <span class="ansi-cyan-fg">call_wrapped</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    147</span>     gen <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">    148</span> 
<span class="ansi-green-fg">--&gt; 149</span><span class="ansi-red-fg">     </span>ans <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>f<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>dict<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>params<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    150</span>     <span class="ansi-green-fg">del</span> args
<span class="ansi-green-intense-fg ansi-bold">    151</span>     <span class="ansi-green-fg">while</span> stack<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">&lt;ipython-input-1-2ff1168f5a07&gt;</span> in <span class="ansi-cyan-fg">do_fit</span><span class="ansi-blue-fg">(ignored_param)</span>
<span class="ansi-green-intense-fg ansi-bold">     46</span>     <span class="ansi-red-fg">#fit = jax.jit(fit)</span>
<span class="ansi-green-intense-fg ansi-bold">     47</span> 
<span class="ansi-green-fg">---&gt; 48</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">return</span> fit<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">1.</span><span class="ansi-blue-fg">,</span>ignored_param<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     49</span> 
<span class="ansi-green-intense-fg ansi-bold">     50</span> ignored_param <span class="ansi-blue-fg">=</span> <span class="ansi-cyan-fg">1</span>

<span class="ansi-green-fg">&lt;ipython-input-1-2ff1168f5a07&gt;</span> in <span class="ansi-cyan-fg">global_fit</span><span class="ansi-blue-fg">(init, ignored_param)</span>
<span class="ansi-green-intense-fg ansi-bold">     35</span> 
<span class="ansi-green-intense-fg ansi-bold">     36</span>     <span class="ansi-green-fg">def</span> global_fit<span class="ansi-blue-fg">(</span>init<span class="ansi-blue-fg">,</span> ignored_param<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 37</span><span class="ansi-red-fg">         </span>solve <span class="ansi-blue-fg">=</span> global_solve<span class="ansi-blue-fg">(</span>init<span class="ansi-blue-fg">,</span> ignored_param<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     38</span>         <span class="ansi-green-fg">return</span> solve<span class="ansi-blue-fg">.</span>value
<span class="ansi-green-intense-fg ansi-bold">     39</span> 

<span class="ansi-green-fg">~/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/api.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self, *args)</span>
<span class="ansi-green-intense-fg ansi-bold">   1440</span>     outs = self.prim.bind(*it.chain(consts, args_flat), jaxpr=jaxpr,
<span class="ansi-green-intense-fg ansi-bold">   1441</span>                           in_tree<span class="ansi-blue-fg">=</span>in_tree<span class="ansi-blue-fg">,</span> out_tree<span class="ansi-blue-fg">=</span>out_tree<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">-&gt; 1442</span><span class="ansi-red-fg">                           num_consts=len(consts))
</span><span class="ansi-green-intense-fg ansi-bold">   1443</span>     <span class="ansi-green-fg">return</span> tree_unflatten<span class="ansi-blue-fg">(</span>out_tree<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> outs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1444</span> 

<span class="ansi-green-fg">~/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/core.py</span> in <span class="ansi-cyan-fg">bind</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    180</span> 
<span class="ansi-green-intense-fg ansi-bold">    181</span>     tracers <span class="ansi-blue-fg">=</span> map<span class="ansi-blue-fg">(</span>top_trace<span class="ansi-blue-fg">.</span>full_raise<span class="ansi-blue-fg">,</span> args<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 182</span><span class="ansi-red-fg">     </span>out_tracer <span class="ansi-blue-fg">=</span> top_trace<span class="ansi-blue-fg">.</span>process_primitive<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> tracers<span class="ansi-blue-fg">,</span> kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    183</span>     <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>multiple_results<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    184</span>       <span class="ansi-green-fg">return</span> map<span class="ansi-blue-fg">(</span>full_lower<span class="ansi-blue-fg">,</span> out_tracer<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/interpreters/partial_eval.py</span> in <span class="ansi-cyan-fg">process_primitive</span><span class="ansi-blue-fg">(self, primitive, tracers, params)</span>
<span class="ansi-green-intense-fg ansi-bold">     96</span>       <span class="ansi-green-fg">return</span> custom_partial_eval_rules<span class="ansi-blue-fg">[</span>primitive<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>tracers<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>params<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     97</span>     <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 98</span><span class="ansi-red-fg">       </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>default_process_primitive<span class="ansi-blue-fg">(</span>primitive<span class="ansi-blue-fg">,</span> tracers<span class="ansi-blue-fg">,</span> params<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     99</span> 
<span class="ansi-green-intense-fg ansi-bold">    100</span>   <span class="ansi-green-fg">def</span> default_process_primitive<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> primitive<span class="ansi-blue-fg">,</span> tracers<span class="ansi-blue-fg">,</span> params<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/interpreters/partial_eval.py</span> in <span class="ansi-cyan-fg">default_process_primitive</span><span class="ansi-blue-fg">(self, primitive, tracers, params)</span>
<span class="ansi-green-intense-fg ansi-bold">    104</span>     tracers <span class="ansi-blue-fg">=</span> map<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>instantiate_const<span class="ansi-blue-fg">,</span> tracers<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    105</span>     avals <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>t<span class="ansi-blue-fg">.</span>aval <span class="ansi-green-fg">for</span> t <span class="ansi-green-fg">in</span> tracers<span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg">--&gt; 106</span><span class="ansi-red-fg">     </span>out_aval <span class="ansi-blue-fg">=</span> primitive<span class="ansi-blue-fg">.</span>abstract_eval<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>avals<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>params<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    107</span>     <span class="ansi-green-fg">if</span> primitive<span class="ansi-blue-fg">.</span>multiple_results<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    108</span>       out_tracers = [JaxprTracer(self, PartialVal((aval, unit)), None)

<span class="ansi-green-fg">~/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/api.py</span> in <span class="ansi-cyan-fg">fun_abstract_eval</span><span class="ansi-blue-fg">(*avals, **params)</span>
<span class="ansi-green-intense-fg ansi-bold">   1503</span> 
<span class="ansi-green-intense-fg ansi-bold">   1504</span>   <span class="ansi-green-fg">def</span> fun_abstract_eval<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>avals<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>params<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1505</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">return</span> pe<span class="ansi-blue-fg">.</span>abstract_eval_fun<span class="ansi-blue-fg">(</span>fun_impl<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>avals<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>params<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1506</span>   fun_p<span class="ansi-blue-fg">.</span>def_abstract_eval<span class="ansi-blue-fg">(</span>fun_abstract_eval<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1507</span> 

<span class="ansi-green-fg">~/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/interpreters/partial_eval.py</span> in <span class="ansi-cyan-fg">abstract_eval_fun</span><span class="ansi-blue-fg">(fun, *avals, **params)</span>
<span class="ansi-green-intense-fg ansi-bold">    271</span>   pvals_in <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>PartialVal<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">(</span>a<span class="ansi-blue-fg">,</span> unit<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> a <span class="ansi-green-fg">in</span> avals<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    272</span>   _, pvals_out, _ = trace_to_jaxpr(lu.wrap_init(fun, params), pvals_in,
<span class="ansi-green-fg">--&gt; 273</span><span class="ansi-red-fg">                                   instantiate=True)
</span><span class="ansi-green-intense-fg ansi-bold">    274</span>   avals_out<span class="ansi-blue-fg">,</span> _ <span class="ansi-blue-fg">=</span> unzip2<span class="ansi-blue-fg">(</span>pvals_out<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    275</span>   <span class="ansi-green-fg">for</span> aval_out <span class="ansi-green-fg">in</span> avals_out<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/interpreters/partial_eval.py</span> in <span class="ansi-cyan-fg">trace_to_jaxpr</span><span class="ansi-blue-fg">(fun, pvals, instantiate, stage_out_calls)</span>
<span class="ansi-green-intense-fg ansi-bold">    352</span>   <span class="ansi-green-fg">with</span> new_master<span class="ansi-blue-fg">(</span>trace_type<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> master<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    353</span>     fun <span class="ansi-blue-fg">=</span> trace_to_subjaxpr<span class="ansi-blue-fg">(</span>fun<span class="ansi-blue-fg">,</span> master<span class="ansi-blue-fg">,</span> instantiate<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 354</span><span class="ansi-red-fg">     </span>jaxpr<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">(</span>out_pvals<span class="ansi-blue-fg">,</span> consts<span class="ansi-blue-fg">,</span> env<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">=</span> fun<span class="ansi-blue-fg">.</span>call_wrapped<span class="ansi-blue-fg">(</span>pvals<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    355</span>     <span class="ansi-green-fg">assert</span> <span class="ansi-green-fg">not</span> env
<span class="ansi-green-intense-fg ansi-bold">    356</span>     <span class="ansi-green-fg">del</span> master

<span class="ansi-green-fg">~/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/linear_util.py</span> in <span class="ansi-cyan-fg">call_wrapped</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    147</span>     gen <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">    148</span> 
<span class="ansi-green-fg">--&gt; 149</span><span class="ansi-red-fg">     </span>ans <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>f<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>dict<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>params<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    150</span>     <span class="ansi-green-fg">del</span> args
<span class="ansi-green-intense-fg ansi-bold">    151</span>     <span class="ansi-green-fg">while</span> stack<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/api.py</span> in <span class="ansi-cyan-fg">fun_impl</span><span class="ansi-blue-fg">(*args, **params)</span>
<span class="ansi-green-intense-fg ansi-bold">   1491</span>   <span class="ansi-green-fg">def</span> fun_impl<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>params<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1492</span>     consts<span class="ansi-blue-fg">,</span> args <span class="ansi-blue-fg">=</span> split_list<span class="ansi-blue-fg">(</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">[</span>params<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;num_consts&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">-&gt; 1493</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">return</span> core<span class="ansi-blue-fg">.</span>eval_jaxpr<span class="ansi-blue-fg">(</span>params<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;jaxpr&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> consts<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1494</span>   fun_p<span class="ansi-blue-fg">.</span>def_impl<span class="ansi-blue-fg">(</span>fun_impl<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1495</span> 

<span class="ansi-green-fg">~/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/core.py</span> in <span class="ansi-cyan-fg">eval_jaxpr</span><span class="ansi-blue-fg">(jaxpr, consts, *args)</span>
<span class="ansi-green-intense-fg ansi-bold">    249</span>     <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    250</span>       subfuns <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg">--&gt; 251</span><span class="ansi-red-fg">     </span>ans <span class="ansi-blue-fg">=</span> eqn<span class="ansi-blue-fg">.</span>primitive<span class="ansi-blue-fg">.</span>bind<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span><span class="ansi-blue-fg">(</span>subfuns <span class="ansi-blue-fg">+</span> in_vals<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>params<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    252</span>     <span class="ansi-green-fg">if</span> eqn<span class="ansi-blue-fg">.</span>primitive<span class="ansi-blue-fg">.</span>multiple_results<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    253</span>       map<span class="ansi-blue-fg">(</span>write<span class="ansi-blue-fg">,</span> eqn<span class="ansi-blue-fg">.</span>outvars<span class="ansi-blue-fg">,</span> ans<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/core.py</span> in <span class="ansi-cyan-fg">bind</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    180</span> 
<span class="ansi-green-intense-fg ansi-bold">    181</span>     tracers <span class="ansi-blue-fg">=</span> map<span class="ansi-blue-fg">(</span>top_trace<span class="ansi-blue-fg">.</span>full_raise<span class="ansi-blue-fg">,</span> args<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 182</span><span class="ansi-red-fg">     </span>out_tracer <span class="ansi-blue-fg">=</span> top_trace<span class="ansi-blue-fg">.</span>process_primitive<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> tracers<span class="ansi-blue-fg">,</span> kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    183</span>     <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>multiple_results<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    184</span>       <span class="ansi-green-fg">return</span> map<span class="ansi-blue-fg">(</span>full_lower<span class="ansi-blue-fg">,</span> out_tracer<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/interpreters/partial_eval.py</span> in <span class="ansi-cyan-fg">process_primitive</span><span class="ansi-blue-fg">(self, primitive, tracers, params)</span>
<span class="ansi-green-intense-fg ansi-bold">     96</span>       <span class="ansi-green-fg">return</span> custom_partial_eval_rules<span class="ansi-blue-fg">[</span>primitive<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>tracers<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>params<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     97</span>     <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 98</span><span class="ansi-red-fg">       </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>default_process_primitive<span class="ansi-blue-fg">(</span>primitive<span class="ansi-blue-fg">,</span> tracers<span class="ansi-blue-fg">,</span> params<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     99</span> 
<span class="ansi-green-intense-fg ansi-bold">    100</span>   <span class="ansi-green-fg">def</span> default_process_primitive<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> primitive<span class="ansi-blue-fg">,</span> tracers<span class="ansi-blue-fg">,</span> params<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/interpreters/partial_eval.py</span> in <span class="ansi-cyan-fg">default_process_primitive</span><span class="ansi-blue-fg">(self, primitive, tracers, params)</span>
<span class="ansi-green-intense-fg ansi-bold">    104</span>     tracers <span class="ansi-blue-fg">=</span> map<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>instantiate_const<span class="ansi-blue-fg">,</span> tracers<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    105</span>     avals <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>t<span class="ansi-blue-fg">.</span>aval <span class="ansi-green-fg">for</span> t <span class="ansi-green-fg">in</span> tracers<span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg">--&gt; 106</span><span class="ansi-red-fg">     </span>out_aval <span class="ansi-blue-fg">=</span> primitive<span class="ansi-blue-fg">.</span>abstract_eval<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>avals<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>params<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    107</span>     <span class="ansi-green-fg">if</span> primitive<span class="ansi-blue-fg">.</span>multiple_results<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    108</span>       out_tracers = [JaxprTracer(self, PartialVal((aval, unit)), None)

<span class="ansi-green-fg">~/envs/neos/lib/python3.7/site-packages/jax-0.1.59-py3.7.egg/jax/lax/lax.py</span> in <span class="ansi-cyan-fg">standard_abstract_eval</span><span class="ansi-blue-fg">(prim, shape_rule, dtype_rule, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   1518</span>            <span class="ansi-blue-fg">&#34;https://github.com/google/jax/issues \n&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">   1519</span>            &#34;since we thought this was unreachable!&#34;)
<span class="ansi-green-fg">-&gt; 1520</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">assert</span> pe<span class="ansi-blue-fg">.</span>_thread_local_state<span class="ansi-blue-fg">.</span>remat<span class="ansi-blue-fg">,</span> msg
<span class="ansi-green-intense-fg ansi-bold">   1521</span>     <span class="ansi-green-fg">return</span> ConcreteArray<span class="ansi-blue-fg">(</span>prim<span class="ansi-blue-fg">.</span>impl<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span><span class="ansi-blue-fg">[</span>x<span class="ansi-blue-fg">.</span>val <span class="ansi-green-fg">for</span> x <span class="ansi-green-fg">in</span> args<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1522</span>   <span class="ansi-green-fg">elif</span> least_specialized <span class="ansi-green-fg">is</span> ShapedArray<span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">AssertionError</span>: If you see this error, please let us know by opening an issue at
https://github.com/google/jax/issues 
since we thought this was unreachable!</pre>
</div>
</div>

</div>
</div>

</div>
</div>
 

